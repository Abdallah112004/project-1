<div class="notification-container" dir="rtl">
    <button class="notification-button" (click)="openNotificationsModal()"
        [class.has-notifications]="notifications.length > 0"
        [attr.aria-label]="'إشعارات (' + notifications.length + ')'">
        <span class="bell-icon">🔔</span>
        <span *ngIf="notifications.length > 0" class="notification-badge">
            {{ notifications.length > 99 ? '99+' : notifications.length }}
        </span>
    </button>

    <!-- المودال -->
    <div *ngIf="showNotificationsModal" class="notification-modal-overlay" (click)="closeNotificationsModal()">
        <div class="notification-modal" (click)="$event.stopPropagation()">

            <!-- رأس المودال -->
            <div class="modal-header">
                <div class="header-content">
                    <h2 class="modal-title">
                        <i class="fas fa-bell"></i>
                        الإشعارات
                    </h2>
                    <div class="header-actions">
                        <button class="action-btn mark-all-read" (click)="markAllAsRead()"
                            *ngIf="hasUnreadNotifications()">
                            <i class="fas fa-check-double"></i>
                            تعليم الكل كمقروء
                        </button>
                        <button class="action-btn test-notification" (click)="sendTestNotification()">
                            <i class="fas fa-plus"></i>
                            إشعار تجريبي
                        </button>
                        <button class="action-btn clear-all" (click)="clearAllNotifications()"
                            *ngIf="notifications.length > 0">
                            <i class="fas fa-trash"></i>
                            مسح الكل
                        </button>
                    </div>
                </div>

                <!-- فلاتر التصنيف -->
                <div class="filter-tabs">
                    <button class="filter-tab" [class.active]="activeFilter === 'all'" (click)="setFilter('all')">
                        الكل ({{ notifications.length }})
                    </button>
                    <button class="filter-tab" [class.active]="activeFilter === 'unread'" (click)="setFilter('unread')">
                        غير المقروء ({{ unreadCount }})
                    </button>
                    <button class="filter-tab" *ngFor="let type of notificationTypes"
                        [class.active]="activeFilter === type" (click)="setFilter(type)">
                        {{ getTypeLabel(type) }} ({{ getTypeCount(type) }})
                    </button>
                </div>
            </div>

            <!-- جسم المودال -->
            <div class="modal-body">

                <!-- حالة التحميل -->
                <div *ngIf="isLoading" class="loading-state">
                    <div class="spinner"></div>
                    <p>جاري تحميل الإشعارات...</p>
                </div>

                <!-- حالة عدم وجود إشعارات -->
                <div *ngIf="!isLoading && filteredNotifications.length === 0" class="empty-state">
                    <div class="empty-icon">
                        <i class="fas fa-bell-slash"></i>
                    </div>
                    <h3>لا توجد إشعارات</h3>
                    <p *ngIf="activeFilter === 'all'">لم تتلق أي إشعارات حتى الآن</p>
                    <p *ngIf="activeFilter === 'unread'">لا توجد إشعارات غير مقروءة</p>
                    <p *ngIf="activeFilter !== 'all' && activeFilter !== 'unread'">
                        لا توجد إشعارات من نوع {{ getTypeLabel(activeFilter) }}
                    </p>
                    <button class="btn-primary" (click)="sendTestNotification()">
                        <i class="fas fa-plus"></i>
                        إنشاء إشعار تجريبي
                    </button>
                </div>

                <!-- قائمة الإشعارات -->
                <div *ngIf="!isLoading && filteredNotifications.length > 0" class="notifications-list">
                    <div *ngFor="let notification of filteredNotifications" class="notification-item"
                        [class.unread]="!isRead(notification)" [class]="'notification-' + notification.type">

                        <div class="notification-main">
                            <!-- أيقونة النوع -->
                            <div class="notification-icon" [class]="'icon-' + notification.type">
                                {{ getNotificationIcon(notification.type) }}
                            </div>

                            <!-- محتوى الإشعار -->
                            <div class="notification-content">
                                <div class="notification-header">
                                    <h4 class="notification-title">{{ notification.title }}</h4>
                                    <span class="notification-time">
                                        {{ formatTimeAgo(notification.timestamp) }}
                                    </span>
                                </div>

                                <p class="notification-message">{{ notification.message }}</p>

                                <div class="notification-meta">
                                    <span class="notification-type" [class]="'type-' + notification.type">
                                        {{ getTypeLabel(notification.type) }}
                                    </span>
                                    <span class="notification-id" *ngIf="notification.id">
                                        #{{ notification.id.slice(-6) }}
                                    </span>
                                </div>
                            </div>
                        </div>

                        <!-- أزرار الإجراءات -->
                        <div class="notification-actions">
                            <button class="action-btn read-btn" *ngIf="!isRead(notification)"
                                (click)="markAsRead(notification.id)" title="تعليم كمقروء"
                                [disabled]="!notification.id">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="action-btn delete-btn" (click)="removeNotification(notification.id)"
                                title="حذف الإشعار" [disabled]="!notification.id">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- تذييلة المودال -->
            <div class="modal-footer">
                <div class="footer-info">
                    <span class="notifications-count">
                        عرض {{ filteredNotifications.length }} من أصل {{ notifications.length }} إشعار
                    </span>
                </div>
                <div class="footer-actions">
                    <button class="btn-secondary" (click)="closeNotificationsModal()">
                        إغلاق
                    </button>
                    <button class="btn-primary" (click)="loadMoreNotifications()" *ngIf="hasMoreNotifications">
                        تحميل المزيد
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
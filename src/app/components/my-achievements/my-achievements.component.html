<div class="achievements-page">
  <app-sidebar class="sidebar"></app-sidebar>

  <div class="achievements-content">
    <!-- عنوان الصفحة -->
    <div class="header-box mb-4 p-4 rounded shadow-sm">
      <h2 class="fw-bold text-white mb-1">جميع الإنجازات</h2>
      <p class="text-light opacity-75 mb-0">مراجعة واعتماد الإنجازات المقدمة</p>
    </div>

    <!-- شريط البحث والتصفية -->
    <div class="filter-bar mb-4 d-flex flex-wrap align-items-center gap-2">
      <input type="text" class="form-control search-input" placeholder="ابحث عن إنجاز..." [(ngModel)]="searchTerm" />

      <select class="form-select filter-select" [(ngModel)]="statusFilter">
        <option value="all">جميع الحالات</option>
        <option value="قيد المراجعة">قيد المراجعة</option>
        <option value="معتمد">معتمد</option>
        <option value="مرفوض">مرفوض</option>
      </select>

      <button class="btn btn-outline-secondary reset-btn" (click)="resetFilters()">
        <i class="fas fa-undo-alt me-1"></i> إعادة تعيين
      </button>
    </div>

    <!-- قائمة الإنجازات -->
    <div *ngFor="let achievement of filteredAchievements()" class="achievement-card shadow-sm">
      <div class="d-flex justify-content-between align-items-start flex-wrap">
        <div class="flex-grow-1">
          <h5 class="achievement-title">{{ achievement.activityTitle }}</h5>
          <p class="achievement-desc">{{ achievement.activityDescription }}</p>
          <div class="achievement-meta text-muted small">
            {{ getNameField(achievement.MainCriteria) }} ←
            {{ getNameField(achievement.SubCriteria) }}
          </div>
        </div>

        <div class="status-box mt-2 mt-md-0">
          <span class="badge status-badge" [ngClass]="getStatusClass(achievement.status)">
            {{ achievement.status }}
          </span>
        </div>
      </div>

      <div class="achievement-footer mt-3 d-flex justify-content-between align-items-center flex-wrap">
        <div class="user-info small text-muted">
          <i class="fas fa-user"></i> {{ achievement.name }}
          <span class="mx-2">•</span>
          <i class="fas fa-map-marker-alt"></i> {{ achievement.department }}
          <span class="mx-2">•</span>
          <i class="fas fa-calendar-alt"></i> {{ achievement.date }}
        </div>

        <div class="actions d-flex gap-2 mt-2 mt-md-0">
          <button class="btn btn-outline-info btn-sm" (click)="openDetailsModal(achievement)">
            <i class="fas fa-eye"></i> عرض
          </button>

          <button class="btn btn-outline-danger btn-sm" *ngIf="achievement._id"
            (click)="handleAction('delete', achievement._id)">
            <i class="fas fa-trash-alt"></i> حذف
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- نافذة التفاصيل -->
<div class="modal fade show" tabindex="-1" style="display: block" *ngIf="showDetailsModal && selectedAchievement">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">تفاصيل الإنجاز</h5>
        <button type="button" class="btn-close" (click)="closeDetailsModal()"></button>
      </div>

      <div class="modal-body">
        <p><strong>العنوان:</strong> {{ selectedAchievement.activityTitle }}</p>
        <p><strong>الوصف:</strong> {{ selectedAchievement.activityDescription }}</p>
        <p><strong>المعيار الرئيسي:</strong> {{ getNameField(selectedAchievement.MainCriteria) }}</p>
        <p><strong>المعيار الفرعي:</strong> {{ getNameField(selectedAchievement.SubCriteria) }}</p>
        <p><strong>الحالة:</strong> {{ selectedAchievement.status }}</p>
      </div>

      <div class="modal-footer">
        <button class="btn btn-success" *ngIf="selectedAchievement?._id"
          (click)="handleAction('approve', selectedAchievement._id!)">
          <i class="fas fa-check"></i> اعتماد
        </button>

        <button class="btn btn-warning text-white" *ngIf="selectedAchievement?._id"
          (click)="handleAction('reassign', selectedAchievement._id!)">
          <i class="fas fa-redo-alt"></i> إعادة للمراجعة
        </button>

        <button class="btn btn-danger" (click)="openRejectModal(selectedAchievement!)">
          <i class="fas fa-times"></i> رفض
        </button>

        <button class="btn btn-secondary" (click)="closeDetailsModal()">
          إغلاق
        </button>
      </div>
    </div>
  </div>
</div>
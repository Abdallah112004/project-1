<div class="dashboard-container" dir="rtl">
  <div class="dashboard-layout">
    <div class="sidebar-section">
      <app-sidebar></app-sidebar>
    </div>

    <div class="main-content">
      <div class="dashboard-header">
        <div class="header-content">
          <div class="welcome-section">
            <h1 class="page-title">لوحة التحكم</h1>
            <p class="welcome-message">مرحباً {{ currentUser.fullName }}، نتمنى لك يوماً مثمراً</p>
            <div class="user-role-badge">
              <span class="badge" [class]="getRoleBadgeClass()">{{ getRoleDisplayName() }}</span>
            </div>
          </div>
          <button class="btn btn-primary add-achievement-btn" routerLink="/add-achievement" routerLinkActive="active">
            <i class="fas fa-plus-circle"></i>
            إضافة نشاط جديد
          </button>
        </div>
      </div>

      <!-- إحصائيات المستخدم الحالي -->
      <div class="stats-section">
        <div class="row g-3">
          <div class="col-6 col-lg-3">
            <div class="stat-card total">
              <div class="card-icon">
                <i class="fas fa-chart-bar"></i>
              </div>
              <div class="card-content">
                <h6 class="stat-label">إجمالي أنشطتي</h6>
                <h3 class="stat-value">{{ userStats.totalActivities }}</h3>
                <small class="stat-subtext">جميع الأنشطة المقدمة</small>
              </div>
            </div>
          </div>
          <div class="col-6 col-lg-3">
            <div class="stat-card pending">
              <div class="card-icon">
                <i class="fas fa-clock"></i>
              </div>
              <div class="card-content">
                <h6 class="stat-label">قيد المراجعة</h6>
                <h3 class="stat-value">{{ userStats.pendingActivities }}</h3>
                <small class="stat-subtext">بانتظار الموافقة</small>
              </div>
            </div>
          </div>
          <div class="col-6 col-lg-3">
            <div class="stat-card approved">
              <div class="card-icon">
                <i class="fas fa-check-circle"></i>
              </div>
              <div class="card-content">
                <h6 class="stat-label">المعتمدة</h6>
                <h3 class="stat-value">{{ userStats.approvedActivities }}</h3>
                <small class="stat-subtext">تمت الموافقة عليها</small>
              </div>
            </div>
          </div>
          <div class="col-6 col-lg-3">
            <div class="stat-card rejected">
              <div class="card-icon">
                <i class="fas fa-times-circle"></i>
              </div>
              <div class="card-content">
                <h6 class="stat-label">المرفوضة</h6>
                <h3 class="stat-value">{{ userStats.rejectedActivities }}</h3>
                <small class="stat-subtext">تم رفضها</small>
              </div>
            </div>
          </div>
        </div>

        <!-- إحصائيات إضافية -->
        <div class="row mt-3" *ngIf="userStats.draftActivities > 0">
          <div class="col-12">
            <div class="stat-card draft">
              <div class="card-icon">
                <i class="fas fa-edit"></i>
              </div>
              <div class="card-content">
                <h6 class="stat-label">المسودات</h6>
                <h3 class="stat-value">{{ userStats.draftActivities }}</h3>
                <small class="stat-subtext">أنشطة غير مكتملة</small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- الإنجازات الحديثة للمستخدم الحالي -->
      <div class="recent-achievements-section">
        <div class="section-card">
          <div class="card-header">
            <div class="header-title-section">
              <h5 class="card-title">
                <i class="fas fa-trophy me-2"></i>
                السجل الزمني للإنجازات
              </h5>
              <span class="achievements-count">{{ recentAchievements.length }} إنجاز</span>
            </div>
            <div class="header-actions">
              <button class="btn btn-sm btn-outline-primary" (click)="loadRecentAchievements()">
                <i class="fas fa-sync-alt" [class.fa-spin]="isLoadingAchievements"></i>
                تحديث البيانات
              </button>
            </div>
          </div>
          <div class="card-body">

            <!-- حالة التحميل -->
            <div *ngIf="isLoadingAchievements" class="loading-state">
              <div class="spinner-container">
                <i class="fas fa-spinner fa-spin fa-2x text-primary"></i>
                <p class="loading-text">جاري تحميل السجل الزمني...</p>
              </div>
            </div>

            <!-- حالة عدم وجود بيانات -->
            <div *ngIf="!isLoadingAchievements && recentAchievements.length === 0" class="empty-state">
              <div class="empty-icon">
                <i class="fas fa-clock fa-3x"></i>
              </div>
              <h4 class="empty-title">لا توجد سجلات حديثة</h4>
              <p class="empty-description">لم يتم تسجيل أي إنجازات في الوقت الحالي</p>
              <button class="btn btn-primary empty-action" routerLink="/add-achievement">
                <i class="fas fa-plus-circle me-2"></i>
                بدء إنجاز جديد
              </button>
            </div>

            <!-- عرض البيانات -->
            <div *ngIf="!isLoadingAchievements && recentAchievements.length > 0" class="achievements-timeline">
              <div class="timeline">
                <div *ngFor="let achievement of recentAchievements; let i = index" class="timeline-item"
                  [class]="getAchievementStatusClass(achievement)">

                  <!-- المؤشر الزمني -->
                  <div class="timeline-marker">
                    <div class="marker-icon">
                      <i [class]="getAchievementIcon(achievement)"></i>
                    </div>
                    <div class="timeline-line"></div>
                  </div>

                  <!-- محتوى البطاقة -->
                  <div class="timeline-content">
                    <div class="achievement-card">

                      <!-- رأس البطاقة -->
                      <div class="achievement-header">
                        <div class="achievement-type-badge">
                          <span class="type-badge" [class]="getAchievementTypeClass(achievement)">
                            {{ getAchievementType(achievement) }}
                          </span>
                        </div>
                        <div class="achievement-meta-info">
                          <span class="achievement-date">
                            <i class="fas fa-calendar-alt me-1"></i>
                            {{ formatAchievementDate(achievement.time) }}
                          </span>
                          <span class="achievement-time">
                            <i class="fas fa-clock me-1"></i>
                            {{ getAchievementTime(achievement.time) }}
                          </span>
                        </div>
                      </div>

                      <!-- جسم البطاقة -->
                      <div class="achievement-body">

                        <!-- معلومات المستخدم -->
                        <div class="user-info-section">
                          <div class="user-avatar">
                            <i class="fas fa-user-circle"></i>
                          </div>
                          <div class="user-details">
                            <span class="user-name">{{ getAchievementUser(achievement.message) }}</span>
                            <span class="user-action">{{ getAchievementAction(achievement.message) }}</span>
                          </div>
                        </div>

                        <!-- تفاصيل الإنجاز -->
                        <div class="achievement-details">

                          <!-- عنوان النشاط -->
                          <div class="activity-title-section" *ngIf="getActivityTitle(achievement.message)">
                            <div class="detail-label">
                              <i class="fas fa-heading me-2"></i>
                              العنوان:
                            </div>
                            <div class="detail-value title-value">
                              {{ getActivityTitle(achievement.message) }}
                            </div>
                          </div>

                          <!-- المعيار -->
                          <div class="activity-standard-section" *ngIf="getActivityStandard(achievement.message)">
                            <div class="detail-label">
                              <i class="fas fa-layer-group me-2"></i>
                              المعيار:
                            </div>
                            <div class="detail-value standard-value">
                              {{ getActivityStandard(achievement.message) }}
                            </div>
                          </div>

                          <!-- المؤشر -->
                          <div class="activity-indicator-section" *ngIf="getActivityIndicator(achievement.message)">
                            <div class="detail-label">
                              <i class="fas fa-bullseye me-2"></i>
                              المؤشر:
                            </div>
                            <div class="detail-value indicator-value">
                              {{ getActivityIndicator(achievement.message) }}
                            </div>
                          </div>

                        </div>

                      </div>

                      <!-- تذييلة البطاقة -->
                      <div class="achievement-footer">
                        <div class="status-section">
                          <span class="status-badge" [class]="getStatusBadgeClass(achievement)">
                            <i class="fas fa-circle me-1"></i>
                            {{ getAchievementStatus(achievement) }}
                          </span>
                        </div>
                        <div class="id-section">
                          <span class="achievement-id">
                            <i class="fas fa-hashtag me-1"></i>
                            {{ achievement.id.slice(-8) }}
                          </span>
                        </div>
                      </div>

                    </div>
                  </div>

                </div>
              </div>
            </div>

          </div>
        </div>
      </div>

      <footer class="dashboard-footer">
        <div class="footer-content">
          <i class="fas fa-university"></i>
          <span>الجهة المطوّرة: جامعة قنا – كلية حاسبات ومعلومات</span>
        </div>
      </footer>
    </div>
  </div>
</div>
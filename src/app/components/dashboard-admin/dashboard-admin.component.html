<div class="container" dir="rtl">
  <div class="col-md-2">
    <app-sidebar></app-sidebar>
  </div>

  <div
    class="d-flex flex-column flex-sm-row justify-content-between align-items-start align-items-sm-center mb-4 gap-2">
    <div>
      <h1 class="h4">ุงูุฑุฆูุณูุฉ</h1>
      <p class="text-muted">ูุฑุญุจุงู {{ currentUser.fullName }}</p>
    </div>
    <button class="btn btn-primary" routerLink="/add-achievement" routerLinkActive="active">
      ุฅุถุงูุฉ ูุดุงุท ุฌุฏูุฏ
    </button>
  </div>

  <div class="row g-3 mb-4">
    <div class="col-6 col-lg-3">
      <div class="card h-100 text-center">
        <div class="card-body">
          <h6 class="text-muted">ุฅุฌูุงูู ุงูุฃูุดุทุฉ</h6>
          <h3>{{ getStatValue('total') }}</h3>
        </div>
      </div>
    </div>
    <div class="col-6 col-lg-3">
      <div class="card h-100 text-center">
        <div class="card-body">
          <h6 class="text-muted">ููุฏ ุงููุฑุงุฌุนุฉ</h6>
          <h3>{{ getStatValue('pending') }}</h3>
        </div>
      </div>
    </div>
    <div class="col-6 col-lg-3">
      <div class="card h-100 text-center">
        <div class="card-body">
          <h6 class="text-muted">ุงููุนุชูุฏุฉ</h6>
          <h3>{{ getStatValue('approved') }}</h3>
        </div>
      </div>
    </div>
    <div class="col-6 col-lg-3">
      <div class="card h-100 text-center">
        <div class="card-body">
          <h6 class="text-muted">ุงููุฑููุถุฉ</h6>
          <h3>{{ getStatValue('rejected') }}</h3>
        </div>
      </div>
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-body">
      <div class="row g-2">
        <div class="col-12 col-md-3">
          <input type="text" class="form-control" placeholder="ุงูุจุญุซ..." [(ngModel)]="searchQuery"
            (input)="applyFilters()" />
        </div>

        <div class="col-12 col-md-3">
          <select class="form-select" [(ngModel)]="statusFilter" (change)="applyFilters()">
            <option value="all">ุฌููุน ุงูุญุงูุงุช</option>
            <option value="pending">ููุฏ ุงููุฑุงุฌุนุฉ</option>
            <option value="approved">ูุนุชูุฏ</option>
            <option value="rejected">ูุฑููุถ</option>
          </select>
        </div>

        <div class="col-12 col-md-3" *ngIf="departments.length > 0">
          <select class="form-select" [(ngModel)]="departmentFilter" (change)="applyFilters()">
            <option value="all">ุฌููุน ุงูุฃูุณุงู</option>
            <option *ngFor="let dept of departments" [value]="dept">
              {{ dept }}
            </option>
          </select>
        </div>

        <div class="col-12 col-md-3">
          <button class="btn btn-outline-secondary w-100" (click)="resetFilters()">
            ุฅุนุงุฏุฉ ุชุนููู
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <h5 class="card-title mb-3">ุงูุฃูุดุทุฉ ุงููุณุฌูุฉ</h5>

      <div *ngIf="filteredActivities.length === 0" class="text-center text-muted py-4">
        ูุง ุชูุฌุฏ ุฃูุดุทุฉ ูุทุงุจูุฉ ููููุงุชุฑ ุงููุญุฏุฏุฉ
      </div>

      <div class="list-group">
        <div *ngFor="let a of filteredActivities"
          class="list-group-item list-group-item-action d-flex flex-column flex-sm-row justify-content-between align-items-start">
          <div class="flex-grow-1">
            <h6 class="mb-1">{{ a.activityTitle }}</h6>
            <small class="text-muted">
              {{ a.name }} โข {{ a.date | date: 'dd/MM/yyyy' }}
            </small>
            <div class="mt-1">
              <span class="text-secondary">{{ a.MainCriteria}}</span>
              <span class="text-muted mx-1">โ</span>
              <span class="text-secondary">{{ a.SubCriteria}}</span>
            </div>
          </div>
          <span class="badge rounded-pill px-3 py-2 mt-2 mt-sm-0" [ngClass]="getStatusClass(a.status)">
            {{ getStatusLabel(a.status) }}
          </span>
        </div>
      </div>
    </div>
  </div>


  <div class="card mb-4">
    <div class="card-body">
      <h5 class="card-title mb-3">ุฃุญุฏุซ ุงูุฅูุฌุงุฒุงุช</h5>
  
      <div *ngIf="recentAchievements.length === 0" class="text-center text-muted py-4">
        ูุง ุชูุฌุฏ ุฅูุฌุงุฒุงุช ุญุฏูุซุฉ
      </div>
  
      <ul class="list-group list-group-flush">
        <li *ngFor="let r of recentAchievements" class="list-group-item">
          <small class="text-muted">{{ r.time | date:'dd/MM/yyyy HH:mm' }}</small>
          <p class="mb-0">{{ r.message }}</p>
        </li>
      </ul>
    </div>
  </div>


  <footer class="text-center mt-4 pt-3 border-top text-muted" style="font-size: 12pt">
    ๐ ุงูุฌูุฉ ุงููุทููุฑุฉ: ุฌุงูุนุฉ ููุง โ ูููุฉ ุญุงุณุจุงุช ููุนูููุงุช
  </footer>
</div>